{"version":3,"sources":["../../../src/drag-drop-list/drag-drop-list.js"],"names":["React","PureComponent","PropTypes","DragDropListItem","overlap","offsetRect","withTheme","ListContainer","noop","DragDropList","items","targetIndex","targetItem","props","boundingBoxes","map","item","boundingBox","instance","getBoundingBox","setState","slice","indexOf","removedIndex","pos","state","nextIndex","maxOverlap","targetRect","deltaX","deltaY","forEach","i","p","canRemoveItem","splice","removedItems","onListChange","renderContent","content","render","theme","style","Boolean","wrapper","key","title","className","_onDragStart","bind","_onDragMove","_onDragEnd","arrayOf","shape","string","oneOfType","node","func","object","bool"],"mappings":"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","sourcesContent":["import React, {PureComponent} from 'react';\nimport PropTypes from 'prop-types';\n\nimport DragDropListItem from './drag-drop-list-item';\nimport {overlap, offsetRect} from './utils';\n\nimport {withTheme} from '../shared/theme';\nimport {ListContainer} from './styled-components';\n\nconst noop = () => {};\n\nclass DragDropList extends PureComponent {\n  static propTypes = {\n    items: PropTypes.arrayOf(\n      PropTypes.shape({\n        key: PropTypes.string,\n        className: PropTypes.string,\n        content: PropTypes.oneOfType([PropTypes.node, PropTypes.func]),\n        title: PropTypes.oneOfType([PropTypes.node, PropTypes.string, PropTypes.func])\n      })\n    ),\n    style: PropTypes.object,\n    canRemoveItem: PropTypes.bool,\n    onListChange: PropTypes.func\n  };\n\n  static defaultProps = {\n    style: {},\n    canRemoveItem: false,\n    onListChange: noop\n  };\n\n  state = {\n    // Temporarily re-arranged items list, used during drag\n    items: null,\n    targetIndex: -1\n  };\n\n  _onDragStart = targetItem => {\n    const {items} = this.props;\n    // Update bounding boxes\n    // This is dependent on page scroll, needs update every time drag starts\n    const boundingBoxes = items.map(item => {\n      item.boundingBox = item.instance.getBoundingBox();\n      return item.boundingBox;\n    });\n\n    this.setState({\n      items: items.slice(),\n      boundingBoxes,\n      targetItem,\n      targetIndex: items.indexOf(targetItem),\n      removedIndex: -1\n    });\n  };\n\n  _onDragMove = pos => {\n    const {items, targetItem, boundingBoxes, targetIndex} = this.state;\n\n    let nextIndex = -1;\n    let maxOverlap = 0;\n\n    const targetRect = offsetRect(targetItem.boundingBox, [pos.deltaX, pos.deltaY]);\n\n    boundingBoxes.forEach((boundingBox, i) => {\n      const p = overlap(boundingBox, targetRect);\n      if (p > maxOverlap) {\n        nextIndex = i;\n        maxOverlap = p;\n      }\n    });\n\n    if (nextIndex < 0) {\n      // removed\n      if (this.props.canRemoveItem) {\n        this.setState({removedIndex: targetIndex});\n      }\n    } else {\n      if (nextIndex !== targetIndex) {\n        items.splice(targetIndex, 1);\n        items.splice(nextIndex, 0, targetItem);\n      }\n      this.setState({targetIndex: nextIndex, removedIndex: -1});\n    }\n  };\n\n  _onDragEnd = pos => {\n    const {items, targetItem, removedIndex} = this.state;\n\n    const removedItems = removedIndex >= 0 ? items.splice(removedIndex, 1) : [];\n    const targetRect = offsetRect(targetItem.boundingBox, [pos.deltaX, pos.deltaY]);\n\n    this.props.onListChange({items, removedItems, targetRect});\n    this.setState({items: null});\n  };\n\n  renderContent({content}) {\n    return typeof content === 'function' ? content() : content;\n  }\n\n  render() {\n    const {theme, style} = this.props;\n    const items = this.state.items || this.props.items;\n\n    return (\n      <ListContainer\n        theme={theme}\n        isDragging={Boolean(this.state.items)}\n        isRemoving={this.state.removedIndex >= 0}\n        userStyle={style.wrapper}\n      >\n        {items &&\n          items.map((item, i) => (\n            <DragDropListItem\n              theme={theme}\n              key={item.key}\n              ref={instance => {\n                item.instance = instance;\n              }}\n              style={style}\n              title={item.title}\n              removed={i === this.state.removedIndex}\n              className={item.className}\n              onDragStart={this._onDragStart.bind(this, item)}\n              onDragMove={this._onDragMove}\n              onDragEnd={this._onDragEnd}\n            >\n              {this.renderContent(item)}\n            </DragDropListItem>\n          ))}\n      </ListContainer>\n    );\n  }\n}\n\nexport default withTheme(DragDropList);\n"],"file":"drag-drop-list.js"}