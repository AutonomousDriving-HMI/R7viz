{"version":3,"sources":["../../../src/imagery-layer/grid-geometry.js"],"names":["GridGeometry","id","uid","uCount","vCount","drawMode","GL","TRIANGLES","opts","Object","assign","attributes","indices","calculateIndices","texCoords","calculateTexCoords","Geometry","uidCounters","count","indicesCount","Uint32Array","i","uIndex","vIndex","i0","i1","i2","i3","Float32Array","value","size"],"mappings":"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","sourcesContent":["// Copyright (c) 2019 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nimport GL from 'luma.gl/constants';\nimport {Geometry} from 'luma.gl';\n\nexport default class GridGeometry extends Geometry {\n  constructor({\n    id = uid('grid-geometry'),\n    uCount = 2,\n    vCount = 2,\n    drawMode = GL.TRIANGLES,\n    ...opts\n  } = {}) {\n    super(\n      Object.assign({}, opts, {\n        id,\n        drawMode,\n        attributes: {\n          indices: calculateIndices({uCount, vCount}),\n          texCoords: calculateTexCoords({uCount, vCount})\n        }\n      })\n    );\n  }\n}\n\nconst uidCounters = {};\n\n/**\n * Returns a UID.\n * @param {String} id= - Identifier base name\n * @return {number} uid\n **/\nfunction uid(id = 'id') {\n  uidCounters[id] = uidCounters[id] || 1;\n  const count = uidCounters[id]++;\n  return `${id}-${count}`;\n}\n\nfunction calculateIndices({uCount, vCount}) {\n  // # of squares = (nx - 1) * (ny - 1)\n  // # of triangles = squares * 2\n  // # of indices = triangles * 3\n  const indicesCount = (uCount - 1) * (vCount - 1) * 2 * 3;\n  const indices = new Uint32Array(indicesCount);\n\n  let i = 0;\n  for (let uIndex = 0; uIndex < uCount - 1; uIndex++) {\n    for (let vIndex = 0; vIndex < vCount - 1; vIndex++) {\n      /*\n       *   i0   i1\n       *    +--.+---\n       *    | / |\n       *    +'--+---\n       *    |   |\n       *   i2   i3\n       */\n      const i0 = vIndex * uCount + uIndex;\n      const i1 = i0 + 1;\n      const i2 = i0 + uCount;\n      const i3 = i2 + 1;\n\n      indices[i++] = i0;\n      indices[i++] = i2;\n      indices[i++] = i1;\n      indices[i++] = i1;\n      indices[i++] = i2;\n      indices[i++] = i3;\n    }\n  }\n\n  return indices;\n}\n\nfunction calculateTexCoords({uCount, vCount}) {\n  const texCoords = new Float32Array(uCount * vCount * 2);\n\n  let i = 0;\n  for (let vIndex = 0; vIndex < vCount; vIndex++) {\n    for (let uIndex = 0; uIndex < uCount; uIndex++) {\n      texCoords[i++] = uIndex / (uCount - 1);\n      texCoords[i++] = vIndex / (vCount - 1);\n    }\n  }\n\n  return {value: texCoords, size: 2};\n}\n"],"file":"grid-geometry.js"}