{"version":3,"sources":["../../../src/imagery-layer/grid-geometry.js"],"names":["GL","Geometry","GridGeometry","constructor","id","uid","uCount","vCount","drawMode","TRIANGLES","opts","Object","assign","attributes","indices","calculateIndices","texCoords","calculateTexCoords","uidCounters","count","indicesCount","Uint32Array","i","uIndex","vIndex","i0","i1","i2","i3","Float32Array","value","size"],"mappings":"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","sourcesContent":["// Copyright (c) 2019 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nimport GL from 'luma.gl/constants';\nimport {Geometry} from 'luma.gl';\n\nexport default class GridGeometry extends Geometry {\n  constructor({\n    id = uid('grid-geometry'),\n    uCount = 2,\n    vCount = 2,\n    drawMode = GL.TRIANGLES,\n    ...opts\n  } = {}) {\n    super(\n      Object.assign({}, opts, {\n        id,\n        drawMode,\n        attributes: {\n          indices: calculateIndices({uCount, vCount}),\n          texCoords: calculateTexCoords({uCount, vCount})\n        }\n      })\n    );\n  }\n}\n\nconst uidCounters = {};\n\n/**\n * Returns a UID.\n * @param {String} id= - Identifier base name\n * @return {number} uid\n **/\nfunction uid(id = 'id') {\n  uidCounters[id] = uidCounters[id] || 1;\n  const count = uidCounters[id]++;\n  return `${id}-${count}`;\n}\n\nfunction calculateIndices({uCount, vCount}) {\n  // # of squares = (nx - 1) * (ny - 1)\n  // # of triangles = squares * 2\n  // # of indices = triangles * 3\n  const indicesCount = (uCount - 1) * (vCount - 1) * 2 * 3;\n  const indices = new Uint32Array(indicesCount);\n\n  let i = 0;\n  for (let uIndex = 0; uIndex < uCount - 1; uIndex++) {\n    for (let vIndex = 0; vIndex < vCount - 1; vIndex++) {\n      /*\n       *   i0   i1\n       *    +--.+---\n       *    | / |\n       *    +'--+---\n       *    |   |\n       *   i2   i3\n       */\n      const i0 = vIndex * uCount + uIndex;\n      const i1 = i0 + 1;\n      const i2 = i0 + uCount;\n      const i3 = i2 + 1;\n\n      indices[i++] = i0;\n      indices[i++] = i2;\n      indices[i++] = i1;\n      indices[i++] = i1;\n      indices[i++] = i2;\n      indices[i++] = i3;\n    }\n  }\n\n  return indices;\n}\n\nfunction calculateTexCoords({uCount, vCount}) {\n  const texCoords = new Float32Array(uCount * vCount * 2);\n\n  let i = 0;\n  for (let vIndex = 0; vIndex < vCount; vIndex++) {\n    for (let uIndex = 0; uIndex < uCount; uIndex++) {\n      texCoords[i++] = uIndex / (uCount - 1);\n      texCoords[i++] = vIndex / (vCount - 1);\n    }\n  }\n\n  return {value: texCoords, size: 2};\n}\n"],"file":"grid-geometry.js"}