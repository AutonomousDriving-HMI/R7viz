{"version":3,"sources":["../../../src/loaders/xviz-controller-v2.js"],"names":["XVIZControllerV2","socket","transformCounter","type","message","msg","data","send","JSON","stringify","startTimestamp","endTimestamp","start_timestamp","end_timestamp","id","_send"],"mappings":";;;;;;;AAoBA;;;;;;;;;;AAEA;;;;;;;;;;;;AAYA;;;;IAIqBA,gB;;;AACnB,4BAAYC,MAAZ,EAAoB;AAAA;;AAClB,yBAAOA,MAAP,EAAe,aAAf;AACA,SAAKA,MAAL,GAAcA,MAAd;AACA,SAAKC,gBAAL,GAAwB,CAAxB;AACD;;;;0BAEKC,I,EAAMC,O,EAAS;AACnB,UAAMC,GAAG,GAAG;AAACF,QAAAA,IAAI,iBAAUA,IAAV,CAAL;AAAuBG,QAAAA,IAAI,EAAEF;AAA7B,OAAZ;AACA,WAAKH,MAAL,CAAYM,IAAZ,CAAiBC,IAAI,CAACC,SAAL,CAAeJ,GAAf,CAAjB;AACD;;;mCAEiD;AAAA,qFAAJ,EAAI;AAAA,UAApCK,cAAoC,QAApCA,cAAoC;AAAA,UAApBC,YAAoB,QAApBA,YAAoB;;AAChD,UAAMN,GAAG,GAAG,EAAZ;;AACA,UAAIK,cAAJ,EAAoB;AAClBL,QAAAA,GAAG,CAACO,eAAJ,GAAsBF,cAAtB,CADkB,CACoB;AACvC;;AAED,UAAIC,YAAJ,EAAkB;AAChBN,QAAAA,GAAG,CAACQ,aAAJ,GAAoBF,YAApB,CADgB,CACkB;AACnC,OAR+C,CAUhD;;;AACAN,MAAAA,GAAG,CAACS,EAAJ,aAAY,KAAKZ,gBAAjB;AACA,WAAKA,gBAAL;;AAEA,WAAKa,KAAL,CAAW,eAAX,EAA4BV,GAA5B;AACD","sourcesContent":["// Copyright (c) 2019 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nimport assert from 'assert';\n\n/* XVIZ Controller\n *\n * XVIZController should present a uniform base object interface (as much as possible)\n * such that application logic doesn't need to know the difference between the protocols.\n *\n * Intention is to add bi-directional protocol concepts:\n *  - stop\n *  - seek\n *  - pause\n *  ...\n */\n\n/* XVIZControllerV1\n *\n * XVIZ v1 handler that opens the log on connetion and closes when 'done' is received.\n */\nexport default class XVIZControllerV2 {\n  constructor(socket) {\n    assert(socket, 'XVIZ socket');\n    this.socket = socket;\n    this.transformCounter = 0;\n  }\n\n  _send(type, message) {\n    const msg = {type: `xviz/${type}`, data: message};\n    this.socket.send(JSON.stringify(msg));\n  }\n\n  transformLog({startTimestamp, endTimestamp} = {}) {\n    const msg = {};\n    if (startTimestamp) {\n      msg.start_timestamp = startTimestamp; // eslint-disable-line camelcase\n    }\n\n    if (endTimestamp) {\n      msg.end_timestamp = endTimestamp; // eslint-disable-line camelcase\n    }\n\n    // Add in a sequential id\n    msg.id = `${this.transformCounter}`;\n    this.transformCounter++;\n\n    this._send('transform_log', msg);\n  }\n}\n"],"file":"xviz-controller-v2.js"}