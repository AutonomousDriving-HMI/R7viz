{"version":3,"sources":["../../../../src/components/log-viewer/index.js"],"names":["React","PureComponent","PropTypes","setObjectState","Core3DViewer","HoverTooltip","connectToLog","DEFAULT_VIEW_STATE","noop","preventDefault","evt","LogViewer","props","viewState","viewOffset","setState","onViewStateChange","info","showTooltip","object","hoverInfo","state","objectId","id","onSelectObject","objectStates","isObjectSelected","selected","stateName","value","onObjectStateChange","onContextMenu","width","height","longitude","latitude","viewMode","initialViewState","x","y","bearing","style","renderTooltip","tooltip","_onViewStateChange","_onClickObject","_onHoverObject","_onContextMenu","_renderTooltip","propTypes","frame","metadata","func","defaultProps","getTransformMatrix","streamName","context","getLogState","log","getCurrentFrame","getMetadata","Component"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA,OAAOA,KAAP,IAAeC,aAAf,QAAmC,OAAnC;AACA,OAAOC,SAAP,MAAsB,YAAtB;AAEA,SAAQC,cAAR,QAA6B,0BAA7B;AAEA,OAAOC,YAAP,MAAyB,kBAAzB;AACA,OAAOC,YAAP,MAAyB,iBAAzB;AAEA,OAAOC,YAAP,MAAyB,YAAzB;AACA,SAAQC,kBAAR,QAAiC,iBAAjC;;AAEA,IAAMC,IAAI,GAAG,SAAPA,IAAO,GAAM,CAAE,CAArB;;AACA,IAAMC,cAAc,GAAG,SAAjBA,cAAiB,CAAAC,GAAG;AAAA,SAAIA,GAAG,CAACD,cAAJ,EAAJ;AAAA,CAA1B;;IAEME,S;;;;;AAmCJ,qBAAYC,KAAZ,EAAmB;AAAA;;AAAA;;AACjB,mFAAMA,KAAN;;AADiB,iGAsBE,gBAA6B;AAAA,UAA3BC,SAA2B,QAA3BA,SAA2B;AAAA,UAAhBC,UAAgB,QAAhBA,UAAgB;;AAChD,YAAKC,QAAL,CAAc;AAACF,QAAAA,SAAS,EAATA,SAAD;AAAYC,QAAAA,UAAU,EAAVA;AAAZ,OAAd;;AACA,YAAKF,KAAL,CAAWI,iBAAX,CAA6B;AAACH,QAAAA,SAAS,EAATA,SAAD;AAAYC,QAAAA,UAAU,EAAVA;AAAZ,OAA7B;AACD,KAzBkB;;AAAA,6FA2BF,UAACG,IAAD,EAAOP,GAAP,EAAe;AAC9B,UAAI,MAAKE,KAAL,CAAWM,WAAX,IAA0BD,IAA1B,IAAkCA,IAAI,CAACE,MAA3C,EAAmD;AACjD,cAAKJ,QAAL,CAAc;AAACK,UAAAA,SAAS,EAAEH;AAAZ,SAAd;AACD,OAFD,MAEO,IAAI,MAAKI,KAAL,CAAWD,SAAf,EAA0B;AAC/B,cAAKL,QAAL,CAAc;AAACK,UAAAA,SAAS,EAAE;AAAZ,SAAd;AACD;AACF,KAjCkB;;AAAA,6FAmCF,UAACH,IAAD,EAAOP,GAAP,EAAe;AAC9B,UAAMY,QAAQ,GAAGL,IAAI,IAAIA,IAAI,CAACE,MAAb,IAAuBF,IAAI,CAACE,MAAL,CAAYI,EAApD;;AAEA,UAAID,QAAQ,IAAI,CAAC,MAAKV,KAAL,CAAWY,cAAX,CAA0BP,IAA1B,EAAgCP,GAAhC,CAAjB,EAAuD;AACrD;AACA;AAFqD,YAGhDe,YAHgD,GAGhC,MAAKJ,KAH2B,CAGhDI,YAHgD;AAIrD,YAAMC,gBAAgB,GAAGD,YAAY,CAACE,QAAb,IAAyBF,YAAY,CAACE,QAAb,CAAsBL,QAAtB,CAAlD;AAEAG,QAAAA,YAAY,GAAGtB,cAAc,CAACsB,YAAD,EAAe;AAC1CG,UAAAA,SAAS,EAAE,UAD+B;AAE1CL,UAAAA,EAAE,EAAED,QAFsC;AAG1CO,UAAAA,KAAK,EAAE,CAACH;AAHkC,SAAf,CAA7B;;AAMA,cAAKX,QAAL,CAAc;AAACU,UAAAA,YAAY,EAAZA;AAAD,SAAd;;AACA,cAAKb,KAAL,CAAWkB,mBAAX,CAA+BL,YAA/B;AACD;AACF,KArDkB;;AAAA,6FAuDF,UAACR,IAAD,EAAOP,GAAP,EAAe;AAC9B,YAAKE,KAAL,CAAWmB,aAAX,CAAyBd,IAAzB,EAA+BP,GAA/B;AACD,KAzDkB;;AAGjB,UAAKW,KAAL,GAAa;AACXR,MAAAA,SAAS;AACPmB,QAAAA,KAAK,EAAE,CADA;AAEPC,QAAAA,MAAM,EAAE,CAFD;AAGPC,QAAAA,SAAS,EAAE,CAHJ;AAIPC,QAAAA,QAAQ,EAAE;AAJH,SAKJ5B,kBALI,EAMJK,KAAK,CAACwB,QAAN,CAAeC,gBANX,CADE;AASXvB,MAAAA,UAAU,EAAE;AACVwB,QAAAA,CAAC,EAAE,CADO;AAEVC,QAAAA,CAAC,EAAE,CAFO;AAGVC,QAAAA,OAAO,EAAE;AAHC,OATD;AAcXf,MAAAA,YAAY,EAAE,EAdH;AAeXL,MAAAA,SAAS,EAAE;AAfA,KAAb;AAHiB;AAoBlB;;;;qCAuCgB;AAAA,wBAC6B,KAAKR,KADlC;AAAA,UACRM,WADQ,eACRA,WADQ;AAAA,UACKuB,KADL,eACKA,KADL;AAAA,UACYC,aADZ,eACYA,aADZ;AAAA,UAERtB,SAFQ,GAEK,KAAKC,KAFV,CAERD,SAFQ;AAIf,aACEF,WAAW,IACXE,SADA,IAEE,oBAAC,YAAD;AAAc,QAAA,IAAI,EAAEA,SAApB;AAA+B,QAAA,KAAK,EAAEqB,KAAK,CAACE,OAA5C;AAAqD,QAAA,aAAa,EAAED;AAApE,QAHJ;AAMD;;;6BAEQ;AACP,UAAM7B,SAAS,GAAG,KAAKD,KAAL,CAAWC,SAAX,IAAwB,KAAKQ,KAAL,CAAWR,SAArD;AACA,UAAMC,UAAU,GAAG,KAAKF,KAAL,CAAWE,UAAX,IAAyB,KAAKO,KAAL,CAAWP,UAAvD;AACA,UAAMW,YAAY,GAAG,KAAKb,KAAL,CAAWa,YAAX,IAA2B,KAAKJ,KAAL,CAAWI,YAA3D;AAEA,aACE;AAAK,QAAA,aAAa,EAAEhB;AAApB,SACE,oBAAC,YAAD,eACM,KAAKG,KADX;AAEE,QAAA,iBAAiB,EAAE,KAAKgC,kBAF1B;AAGE,QAAA,OAAO,EAAE,KAAKC,cAHhB;AAIE,QAAA,OAAO,EAAE,KAAKC,cAJhB;AAKE,QAAA,aAAa,EAAE,KAAKC,cALtB;AAME,QAAA,SAAS,EAAElC,SANb;AAOE,QAAA,UAAU,EAAEC,UAPd;AAQE,QAAA,YAAY,EAAEW;AARhB,UAUG,KAAKuB,cAAL,EAVH,CADF,CADF;AAgBD;;;;EA/HqB/C,a;;gBAAlBU,S,iCAECP,YAAY,CAAC6C,S;AAEhB;AACAC,EAAAA,KAAK,EAAEhD,SAAS,CAACiB,M;AACjBgC,EAAAA,QAAQ,EAAEjD,SAAS,CAACiB,M;AAEpB;AACAuB,EAAAA,aAAa,EAAExC,SAAS,CAACkD,I;AACzBX,EAAAA,KAAK,EAAEvC,SAAS,CAACiB,M;AAEjB;AACAK,EAAAA,cAAc,EAAEtB,SAAS,CAACkD,I;AAC1BrB,EAAAA,aAAa,EAAE7B,SAAS,CAACkD,I;AACzBpC,EAAAA,iBAAiB,EAAEd,SAAS,CAACkD,I;AAC7BtB,EAAAA,mBAAmB,EAAE5B,SAAS,CAACkD,I;AAE/B;AACAvC,EAAAA,SAAS,EAAEX,SAAS,CAACiB,M;AACrBL,EAAAA,UAAU,EAAEZ,SAAS,CAACiB,M;AACtBM,EAAAA,YAAY,EAAEvB,SAAS,CAACiB;;;gBArBtBR,S,oCAyBCP,YAAY,CAACiD,Y;AAEhBZ,EAAAA,KAAK,EAAE,E;AACPzB,EAAAA,iBAAiB,EAAER,I;AACnBsB,EAAAA,mBAAmB,EAAEtB,I;AACrBgB,EAAAA,cAAc,EAAEhB,I;AAChBuB,EAAAA,aAAa,EAAEvB,I;AACf8C,EAAAA,kBAAkB,EAAE,4BAACC,UAAD,EAAaC,OAAb;AAAA,WAAyB,IAAzB;AAAA;;;AAkGxB,IAAMC,WAAW,GAAG,SAAdA,WAAc,CAAAC,GAAG;AAAA,SAAK;AAC1BR,IAAAA,KAAK,EAAEQ,GAAG,CAACC,eAAJ,EADmB;AAE1BR,IAAAA,QAAQ,EAAEO,GAAG,CAACE,WAAJ;AAFgB,GAAL;AAAA,CAAvB;;AAKA,eAAetD,YAAY,CAAC;AAACmD,EAAAA,WAAW,EAAXA,WAAD;AAAcI,EAAAA,SAAS,EAAElD;AAAzB,CAAD,CAA3B","sourcesContent":["// Copyright (c) 2019 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nimport React, {PureComponent} from 'react';\nimport PropTypes from 'prop-types';\n\nimport {setObjectState} from '../../utils/object-state';\n\nimport Core3DViewer from './core-3d-viewer';\nimport HoverTooltip from './hover-tooltip';\n\nimport connectToLog from '../connect';\nimport {DEFAULT_VIEW_STATE} from '../../constants';\n\nconst noop = () => {};\nconst preventDefault = evt => evt.preventDefault();\n\nclass LogViewer extends PureComponent {\n  static propTypes = {\n    ...Core3DViewer.propTypes,\n\n    // Props from loader\n    frame: PropTypes.object,\n    metadata: PropTypes.object,\n\n    // Rendering options\n    renderTooltip: PropTypes.func,\n    style: PropTypes.object,\n\n    // Callbacks\n    onSelectObject: PropTypes.func,\n    onContextMenu: PropTypes.func,\n    onViewStateChange: PropTypes.func,\n    onObjectStateChange: PropTypes.func,\n\n    // Optional: to use with external state management (e.g. Redux)\n    viewState: PropTypes.object,\n    viewOffset: PropTypes.object,\n    objectStates: PropTypes.object\n  };\n\n  static defaultProps = {\n    ...Core3DViewer.defaultProps,\n\n    style: {},\n    onViewStateChange: noop,\n    onObjectStateChange: noop,\n    onSelectObject: noop,\n    onContextMenu: noop,\n    getTransformMatrix: (streamName, context) => null\n  };\n\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      viewState: {\n        width: 1,\n        height: 1,\n        longitude: 0,\n        latitude: 0,\n        ...DEFAULT_VIEW_STATE,\n        ...props.viewMode.initialViewState\n      },\n      viewOffset: {\n        x: 0,\n        y: 0,\n        bearing: 0\n      },\n      objectStates: {},\n      hoverInfo: null\n    };\n  }\n\n  _onViewStateChange = ({viewState, viewOffset}) => {\n    this.setState({viewState, viewOffset});\n    this.props.onViewStateChange({viewState, viewOffset});\n  };\n\n  _onHoverObject = (info, evt) => {\n    if (this.props.showTooltip && info && info.object) {\n      this.setState({hoverInfo: info});\n    } else if (this.state.hoverInfo) {\n      this.setState({hoverInfo: null});\n    }\n  };\n\n  _onClickObject = (info, evt) => {\n    const objectId = info && info.object && info.object.id;\n\n    if (objectId && !this.props.onSelectObject(info, evt)) {\n      // User callback did not mark event as handled, proceed with default behavior\n      // Select object\n      let {objectStates} = this.state;\n      const isObjectSelected = objectStates.selected && objectStates.selected[objectId];\n\n      objectStates = setObjectState(objectStates, {\n        stateName: 'selected',\n        id: objectId,\n        value: !isObjectSelected\n      });\n\n      this.setState({objectStates});\n      this.props.onObjectStateChange(objectStates);\n    }\n  };\n\n  _onContextMenu = (info, evt) => {\n    this.props.onContextMenu(info, evt);\n  };\n\n  _renderTooltip() {\n    const {showTooltip, style, renderTooltip} = this.props;\n    const {hoverInfo} = this.state;\n\n    return (\n      showTooltip &&\n      hoverInfo && (\n        <HoverTooltip info={hoverInfo} style={style.tooltip} renderContent={renderTooltip} />\n      )\n    );\n  }\n\n  render() {\n    const viewState = this.props.viewState || this.state.viewState;\n    const viewOffset = this.props.viewOffset || this.state.viewOffset;\n    const objectStates = this.props.objectStates || this.state.objectStates;\n\n    return (\n      <div onContextMenu={preventDefault}>\n        <Core3DViewer\n          {...this.props}\n          onViewStateChange={this._onViewStateChange}\n          onClick={this._onClickObject}\n          onHover={this._onHoverObject}\n          onContextMenu={this._onContextMenu}\n          viewState={viewState}\n          viewOffset={viewOffset}\n          objectStates={objectStates}\n        >\n          {this._renderTooltip()}\n        </Core3DViewer>\n      </div>\n    );\n  }\n}\n\nconst getLogState = log => ({\n  frame: log.getCurrentFrame(),\n  metadata: log.getMetadata()\n});\n\nexport default connectToLog({getLogState, Component: LogViewer});\n"],"file":"index.js"}