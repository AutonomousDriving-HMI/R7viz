{"version":3,"sources":["../../../../src/components/declarative-ui/xviz-video.js"],"names":["React","PureComponent","PropTypes","styled","Dropdown","withTheme","evaluateStyle","ImageSequence","connectToLog","normalizeStreamFilter","WrapperComponent","span","props","theme","__reset__","position","userStyle","BaseComponent","streamName","setState","selectedStreamName","state","_getStreamNames","nextProps","streamMetadata","cameras","streamNames","Object","keys","filter","primitive_type","sort","includes","style","length","data","forEach","name","selector","_onSelectVideo","currentTime","streams","width","height","wrapper","_renderVideoSelector","object","oneOfType","number","string","array","func","getLogState","log","metadata","getMetadata","getCurrentTime","getStreams","XVIZVideoComponent","Component"],"mappings":"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","sourcesContent":["// Copyright (c) 2019 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nimport React, {PureComponent} from 'react';\nimport PropTypes from 'prop-types';\n\nimport styled from '@emotion/styled';\nimport {Dropdown, withTheme, evaluateStyle} from '@streetscape.gl/monochrome';\nimport ImageSequence from './image-sequence';\nimport connectToLog from '../connect';\n\nimport {normalizeStreamFilter} from '../../utils/stream-utils';\n\nconst WrapperComponent = styled.span(props => ({\n  ...props.theme.__reset__,\n  position: 'relative',\n  ...evaluateStyle(props.userStyle, props)\n}));\n\nclass BaseComponent extends PureComponent {\n  static propTypes = {\n    // User configuration\n    style: PropTypes.object,\n    width: PropTypes.oneOfType([PropTypes.number, PropTypes.string]),\n    height: PropTypes.oneOfType([PropTypes.number, PropTypes.string]),\n\n    // From declarative UI video component\n    cameras: PropTypes.oneOfType([\n      PropTypes.string,\n      PropTypes.array,\n      PropTypes.object,\n      PropTypes.func\n    ]),\n\n    // From connected log\n    currentTime: PropTypes.number,\n    streamMetadata: PropTypes.object,\n    streams: PropTypes.object\n  };\n\n  static defaultProps = {\n    style: {},\n    width: '100%',\n    height: 'auto'\n  };\n\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      ...this._getStreamNames(props)\n    };\n  }\n\n  componentWillReceiveProps(nextProps) {\n    if (\n      this.props.streamMetadata !== nextProps.streamMetadata ||\n      this.props.cameras !== nextProps.cameras\n    ) {\n      this.setState(this._getStreamNames(nextProps));\n    }\n  }\n\n  _getStreamNames({streamMetadata, cameras}) {\n    if (!streamMetadata) {\n      return {\n        streamNames: null,\n        selectedStreamName: null\n      };\n    }\n\n    const streamNames = Object.keys(streamMetadata)\n      .filter(\n        streamName =>\n          streamMetadata[streamName] && streamMetadata[streamName].primitive_type === 'image'\n      )\n      .filter(normalizeStreamFilter(cameras))\n      .sort();\n    let {selectedStreamName} = this.state || {};\n    if (!streamNames.includes(selectedStreamName)) {\n      selectedStreamName = streamNames[0] || null;\n    }\n    return {selectedStreamName, streamNames};\n  }\n\n  _onSelectVideo = streamName => {\n    this.setState({selectedStreamName: streamName});\n  };\n\n  _renderVideoSelector() {\n    const {style} = this.props;\n    const {streamNames, selectedStreamName} = this.state;\n\n    if (streamNames.length <= 1) {\n      return null;\n    }\n\n    const data = {};\n    streamNames.forEach(name => {\n      // TODO - use display name from metadata\n      data[name] = name;\n    });\n\n    return (\n      <Dropdown\n        style={style.selector}\n        value={selectedStreamName}\n        data={data}\n        onChange={this._onSelectVideo}\n      />\n    );\n  }\n\n  render() {\n    const {currentTime, streams, width, height, style, theme} = this.props;\n    const {selectedStreamName} = this.state;\n\n    if (!streams || !currentTime || !selectedStreamName) {\n      return null;\n    }\n\n    return (\n      <WrapperComponent theme={theme} userStyle={style.wrapper}>\n        <ImageSequence\n          width={width}\n          height={height}\n          src={streams[selectedStreamName]}\n          currentTime={currentTime}\n        />\n\n        {this._renderVideoSelector()}\n      </WrapperComponent>\n    );\n  }\n}\n\nconst getLogState = log => {\n  const metadata = log.getMetadata();\n  return {\n    currentTime: log.getCurrentTime(),\n    streamMetadata: metadata && metadata.streams,\n    streams: log.getStreams()\n  };\n};\n\nconst XVIZVideoComponent = withTheme(BaseComponent);\n\nexport default connectToLog({getLogState, Component: XVIZVideoComponent});\n"],"file":"xviz-video.js"}