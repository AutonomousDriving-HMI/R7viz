{"version":3,"sources":["../../../src/utils/buffer-range.js"],"names":["empty","add","simpleRange","complexRange","isValid","result","r1","j","length","r2","push","Math","min","max","intersect","subtract"],"mappings":"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","sourcesContent":["// Copyright (c) 2019 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n/**\n  Utils for manipulating buffer ranges\n  A valid \"simple range\" is in the shape of [start, end]\n  A valid \"complex range\" is an array of sorted, discrete simple ranges\n */\n\n// Create an empty range\nexport function empty() {\n  return [];\n}\n\n// Join two ranges\nexport function add(simpleRange, complexRange) {\n  if (!isValid(simpleRange)) {\n    return complexRange;\n  }\n\n  const result = [];\n  let r1 = simpleRange;\n\n  for (let j = 0; j < complexRange.length; j++) {\n    const r2 = complexRange[j];\n\n    if (r2[0] > r1[1]) {\n      // [  ]\n      //     [   ]\n      result.push(r1);\n      r1 = r2;\n    } else if (r1[0] > r2[1]) {\n      //      [  ]\n      // [   ]\n      result.push(r2);\n    } else {\n      //   [  ]\n      // [   ]\n      r1 = [Math.min(r1[0], r2[0]), Math.max(r1[1], r2[1])];\n    }\n  }\n  result.push(r1);\n\n  return result;\n}\n\n// Intersect two ranges\nexport function intersect(simpleRange, complexRange) {\n  if (!isValid(simpleRange)) {\n    return empty();\n  }\n\n  const result = [];\n  const r1 = simpleRange;\n\n  for (let j = 0; j < complexRange.length; j++) {\n    const r2 = complexRange[j];\n\n    if (r2[0] < r1[1] && r1[0] < r2[1]) {\n      result.push([Math.max(r1[0], r2[0]), Math.min(r1[1], r2[1])]);\n    }\n  }\n\n  return result;\n}\n\n// Subtract a range from another\nexport function subtract(simpleRange, complexRange) {\n  if (!isValid(simpleRange)) {\n    return empty();\n  }\n\n  const result = [];\n  let r1 = simpleRange;\n\n  for (let j = 0; j < complexRange.length; j++) {\n    const r2 = complexRange[j];\n\n    if (r1[0] >= r2[1]) {\n      //    [   ]\n      // [ ]\n      continue; // eslint-disable-line\n    }\n    if (r2[0] >= r1[1]) {\n      // [   ]\n      //      [ ]\n      break;\n    }\n    if (r2[0] > r1[0]) {\n      // [    ]\n      //   [   ]\n      result.push([r1[0], r2[0]]);\n    }\n    if (r2[1] < r1[1]) {\n      // [    ]\n      //   [ ]\n      r1 = [r2[1], r1[1]];\n    } else {\n      // [    ]\n      //   [  ]\n      r1 = null;\n      break;\n    }\n  }\n  if (r1) {\n    result.push(r1);\n  }\n  return result;\n}\n\nfunction isValid(simpleRange) {\n  return simpleRange[0] < simpleRange[1];\n}\n"],"file":"buffer-range.js"}