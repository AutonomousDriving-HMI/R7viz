{"version":3,"sources":["../../../src/workers/lidar-point-cloud-worker.js"],"names":["setXVIZConfig","parseXVIZStream","TextDecoder","config","self","onmessage","e","dataView","DataView","data","decoder","decodedString","decode","JSON","parse","transfers","map","pointCloud","time","push","ids","buffer","colors","positions","postMessage","close","error","Error"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA,SAAQA,aAAR,QAA4B,uBAA5B;AACA,SAAQC,eAAR,QAA8B,8BAA9B;AACA,SAAQC,WAAR,QAA0B,wBAA1B;AAEA,gBAAe,UAAAC,MAAM;AAAA,SAAI,UAAAC,IAAI,EAAI;AAC/BJ,IAAAA,aAAa,CAACG,MAAD,CAAb;;AAEAC,IAAAA,IAAI,CAACC,SAAL,GAAiB,UAAAC,CAAC,EAAI;AACpB,UAAMC,QAAQ,GAAG,IAAIC,QAAJ,CAAaF,CAAC,CAACG,IAAf,CAAjB;AACA,UAAMC,OAAO,GAAG,IAAIR,WAAJ,CAAgB,OAAhB,CAAhB;AACA,UAAMS,aAAa,GAAGD,OAAO,CAACE,MAAR,CAAeL,QAAf,CAAtB;;AAEA,UAAI;AACF,YAAIE,IAAI,GAAGI,IAAI,CAACC,KAAL,CAAWH,aAAX,CAAX;AACAF,QAAAA,IAAI,GAAGR,eAAe,CAACQ,IAAD,CAAtB;AAEA,YAAMM,SAAS,GAAG,EAAlB;AAEAN,QAAAA,IAAI,GAAGA,IAAI,CAACO,GAAL,CAAS,gBAAwB;AAAA,cAAtBC,UAAsB,QAAtBA,UAAsB;AAAA,cAAVC,IAAU,QAAVA,IAAU;;AACtC,cAAID,UAAJ,EAAgB;AACdF,YAAAA,SAAS,CAACI,IAAV,CACEF,UAAU,CAACG,GAAX,CAAeC,MADjB,EAEEJ,UAAU,CAACK,MAAX,CAAkBD,MAFpB,EAGEJ,UAAU,CAACM,SAAX,CAAqBF,MAHvB;AAKD;;AACD,iBAAO;AAACJ,YAAAA,UAAU,EAAVA,UAAD;AAAaC,YAAAA,IAAI,EAAJA;AAAb,WAAP;AACD,SATM,CAAP,CANE,CAiBF;;AACAd,QAAAA,IAAI,CAACoB,WAAL,EACE;AACAf,QAAAA,IAFF,EAGE;AACA;AACAM,QAAAA,SALF,EAlBE,CA0BF;;AACAX,QAAAA,IAAI,CAACqB,KAAL;AACD,OA5BD,CA4BE,OAAOC,KAAP,EAAc;AACd,cAAM,IAAIC,KAAJ,CAAUD,KAAV,CAAN;AACD;AACF,KApCD;AAqCD,GAxCoB;AAAA,CAArB","sourcesContent":["// Copyright (c) 2019 Uber Technologies, Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport {setXVIZConfig} from '../config/xviz-config';\nimport {parseXVIZStream} from '../parsers/parse-xviz-stream';\nimport {TextDecoder} from '../utils/text-encoding';\n\nexport default config => self => {\n  setXVIZConfig(config);\n\n  self.onmessage = e => {\n    const dataView = new DataView(e.data);\n    const decoder = new TextDecoder('utf-8');\n    const decodedString = decoder.decode(dataView);\n\n    try {\n      let data = JSON.parse(decodedString);\n      data = parseXVIZStream(data);\n\n      const transfers = [];\n\n      data = data.map(({pointCloud, time}) => {\n        if (pointCloud) {\n          transfers.push(\n            pointCloud.ids.buffer,\n            pointCloud.colors.buffer,\n            pointCloud.positions.buffer\n          );\n        }\n        return {pointCloud, time};\n      });\n\n      // https://developer.mozilla.org/en-US/docs/Web/API/Worker/postMessage\n      self.postMessage(\n        // aMessage\n        data,\n        // transferList, calls out which elements inside the data structure of the\n        // first argument to not copy\n        transfers\n      );\n\n      // Terminate\n      self.close();\n    } catch (error) {\n      throw new Error(error);\n    }\n  };\n};\n"],"file":"lidar-point-cloud-worker.js"}