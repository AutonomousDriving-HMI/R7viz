{"version":3,"sources":["../../../src/builders/xviz-future-instance-builder.js"],"names":["XVIZFutureInstanceBuilder","props","category","CATEGORY","future_instance","reset","_futures","timestamp","_ts","future","_streamId","timestamps","primitives","primitive","_formatPrimitive","update","_type","_flush","Object","keys","length","XVIZPrimitiveBuilder"],"mappings":";;;;;;;AAeA;;AACA;;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAEqBA,yB;;;;;AACnB,qCAAYC,KAAZ,EAAmB;AAAA;;AAAA;;AACjB,qHACKA,KADL;AAEEC,MAAAA,QAAQ,EAAEC,mBAASC;AAFrB;;AAKA,UAAKC,KAAL,GANiB,CAOjB;;;AACA,UAAKC,QAAL,GAAgB,EAAhB;AARiB;AASlB;;;;+BAEUC,S,EAAW;AACpB,WAAKC,GAAL,GAAWD,SAAX;AACA,aAAO,IAAP;AACD;;;6BAEQ;AACP,UAAIE,MAAM,GAAG,KAAKH,QAAL,CAAc,KAAKI,SAAnB,CAAb;;AACA,UAAI,CAACD,MAAL,EAAa;AACXA,QAAAA,MAAM,GAAG;AACPE,UAAAA,UAAU,EAAE,EADL;AAEPC,UAAAA,UAAU,EAAE;AAFL,SAAT;AAIA,aAAKN,QAAL,CAAc,KAAKI,SAAnB,IAAgCD,MAAhC;AACD;;AAED,UAAMI,SAAS,GAAG,KAAKC,gBAAL,EAAlB;;AAVO,oBAY0BL,MAZ1B;AAAA,UAYAE,UAZA,WAYAA,UAZA;AAAA,UAYYC,UAZZ,WAYYA,UAZZ,EAcP;AACA;;AACA,UAAMG,MAAM,GAAG,EAAf;AACAA,MAAAA,MAAM,WAAI,KAAKC,KAAT,OAAN,GAA2B,CAACH,SAAD,CAA3B,CAjBO,CAmBP;;AACA,kCAAgBF,UAAhB,EAA4BC,UAA5B,EAAwC,KAAKJ,GAA7C,YAAqD,KAAKQ,KAA1D,QAAoEH,SAApE;AAEA,WAAKR,KAAL;AACD;;;8BAES;AACR,UAAI,KAAKW,KAAT,EAAgB;AACd,aAAKC,MAAL;AACD;;AAED,UAAIC,MAAM,CAACC,IAAP,CAAY,KAAKb,QAAjB,EAA2Bc,MAA3B,KAAsC,CAA1C,EAA6C;AAC3C,eAAO,IAAP;AACD;;AAED,aAAO,KAAKd,QAAZ;AACD;;;4BAEO;AACN;AACD;;;;EAxDoDe,6B","sourcesContent":["// Copyright (c) 2019 Uber Technologies, Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/* eslint-disable camelcase */\nimport XVIZPrimitiveBuilder from './xviz-primitive-builder';\nimport {insertTimestamp} from '../utils';\nimport {CATEGORY} from './constant';\n\nexport default class XVIZFutureInstanceBuilder extends XVIZPrimitiveBuilder {\n  constructor(props) {\n    super({\n      ...props,\n      category: CATEGORY.future_instance\n    });\n\n    this.reset();\n    // futures: {[streamId]: {...,timestamps: [], primitives: []}}\n    this._futures = {};\n  }\n\n  _timestamp(timestamp) {\n    this._ts = timestamp;\n    return this;\n  }\n\n  _flush() {\n    let future = this._futures[this._streamId];\n    if (!future) {\n      future = {\n        timestamps: [],\n        primitives: []\n      };\n      this._futures[this._streamId] = future;\n    }\n\n    const primitive = this._formatPrimitive();\n\n    const {timestamps, primitives} = future;\n\n    // Each type like \"image\" has an \"images\" array, this hack saves a\n    // big switch statement.\n    const update = {};\n    update[`${this._type}s`] = [primitive];\n\n    // insert ts and primitive to the position based on timestamp order\n    insertTimestamp(timestamps, primitives, this._ts, `${this._type}s`, primitive);\n\n    this.reset();\n  }\n\n  getData() {\n    if (this._type) {\n      this._flush();\n    }\n\n    if (Object.keys(this._futures).length === 0) {\n      return null;\n    }\n\n    return this._futures;\n  }\n\n  reset() {\n    super.reset();\n  }\n}\n"],"file":"xviz-future-instance-builder.js"}