{"version":3,"sources":["../../../src/utils/sort.js"],"names":["insertTimestamp","timestamps","values","ts","key","value","targetIndex","findIndex","x","Math","abs","Number","EPSILON","primitives","push","insertIndex","length","splice"],"mappings":";;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;;;;;;;;;AAUA,OAAO,SAASA,eAAT,CAAyBC,UAAzB,EAAqCC,MAArC,EAA6CC,EAA7C,EAAiDC,GAAjD,EAAsDC,KAAtD,EAA6D;AAClE;AACA,MAAMC,WAAW,GAAGL,UAAU,CAACM,SAAX,CAAqB,UAAAC,CAAC;AAAA,WAAIC,IAAI,CAACC,GAAL,CAASF,CAAC,GAAGL,EAAb,IAAmBQ,MAAM,CAACC,OAA9B;AAAA,GAAtB,CAApB;;AACA,MAAIN,WAAW,KAAK,CAAC,CAArB,EAAwB;AACtB;AACA,QAAMO,UAAU,GAAGX,MAAM,CAACI,WAAD,CAAzB;;AACA,QAAI,CAACO,UAAU,CAACT,GAAD,CAAf,EAAsB;AACpBS,MAAAA,UAAU,CAACT,GAAD,CAAV,GAAkB,EAAlB;AACD;;AAEDS,IAAAA,UAAU,CAACT,GAAD,CAAV,CAAgBU,IAAhB,CAAqBT,KAArB;AACD,GARD,MAQO;AACL;AACA,QAAIU,WAAW,GAAGd,UAAU,CAACM,SAAX,CAAqB,UAAAC,CAAC;AAAA,aAAIA,CAAC,GAAGL,EAAR;AAAA,KAAtB,CAAlB;;AACA,QAAIY,WAAW,KAAK,CAAC,CAArB,EAAwB;AACtBA,MAAAA,WAAW,GAAGd,UAAU,CAACe,MAAzB;AACD;;AAEDf,IAAAA,UAAU,CAACgB,MAAX,CAAkBF,WAAlB,EAA+B,CAA/B,EAAkCZ,EAAlC;;AACA,QAAMU,WAAU,uBACbT,GADa,EACP,CAACC,KAAD,CADO,CAAhB;;AAGAH,IAAAA,MAAM,CAACe,MAAP,CAAcF,WAAd,EAA2B,CAA3B,EAA8BF,WAA9B;AACD;AACF","sourcesContent":["// Copyright (c) 2019 Uber Technologies, Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/**\n * Find existing timestamp or insert a new one. The 'values' arrays is a parallel index\n * where the primitives will be added.\n *\n * Primitives will be merged by 'key'\n * @param timestamps list of sorted timestamps\n * @param values list of values sorted based on timestamps\n * @param ts\n * @param value\n */\nexport function insertTimestamp(timestamps, values, ts, key, value) {\n  // Find number that equals the timestamp\n  const targetIndex = timestamps.findIndex(x => Math.abs(x - ts) < Number.EPSILON);\n  if (targetIndex !== -1) {\n    // Add to existing entry\n    const primitives = values[targetIndex];\n    if (!primitives[key]) {\n      primitives[key] = [];\n    }\n\n    primitives[key].push(value);\n  } else {\n    // Insert new entry\n    let insertIndex = timestamps.findIndex(x => x > ts);\n    if (insertIndex === -1) {\n      insertIndex = timestamps.length;\n    }\n\n    timestamps.splice(insertIndex, 0, ts);\n    const primitives = {\n      [key]: [value]\n    };\n    values.splice(insertIndex, 0, primitives);\n  }\n}\n"],"file":"sort.js"}