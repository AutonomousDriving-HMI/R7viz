{"version":3,"sources":["../../../src/builders/xviz-ui-primitive-builder.js"],"names":["XVIZBaseBuilder","CATEGORY","PRIMITIVE_TYPES","XVIZTreeTableRowBuilder","id","values","parent","_parent","_id","_values","_children","row","push","obj","column_values","concat","apply","map","getData","XVIZUIPrimitiveBuilder","props","category","ui_primitive","reset","_primitives","columns","_type","_flush","validatePropSetOnce","_columns","treetable","_row","_validate","_flushPrimitives","Object","keys","length","stream","_streamId","fieldName","primitiveArray","_validator","hasProp","nodes","primitives","_formatPrimitives","primitive"],"mappings":"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","sourcesContent":["// Copyright (c) 2019 Uber Technologies, Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/* eslint-disable camelcase */\nimport XVIZBaseBuilder from './xviz-base-builder';\nimport {CATEGORY, PRIMITIVE_TYPES} from './constant';\n\nclass XVIZTreeTableRowBuilder {\n  constructor(id, values, parent = null) {\n    this._parent = parent;\n    this._id = id;\n    this._values = values;\n    this._children = [];\n  }\n\n  child(id, values) {\n    const row = new XVIZTreeTableRowBuilder(id, values, this._id);\n    this._children.push(row);\n    return row;\n  }\n\n  getData() {\n    const obj = {id: this._id};\n    if (this._values) {\n      obj.column_values = this._values;\n    }\n    if (this._parent !== null) {\n      obj.parent = this._parent;\n    }\n\n    return [].concat.apply([obj], this._children.map(row => row.getData()));\n  }\n}\n\nexport default class XVIZUIPrimitiveBuilder extends XVIZBaseBuilder {\n  constructor(props) {\n    super({\n      ...props,\n      category: CATEGORY.ui_primitive\n    });\n\n    this.reset();\n    // primitives: {[streamId]: []}\n    this._primitives = {};\n  }\n\n  treetable(columns) {\n    if (this._type) {\n      this._flush();\n    }\n\n    this.validatePropSetOnce('_columns');\n\n    this._columns = columns;\n    this._type = PRIMITIVE_TYPES.treetable;\n\n    return this;\n  }\n\n  row(id, values) {\n    if (this._type) {\n      this._flush();\n    }\n\n    this.validatePropSetOnce('_id');\n\n    this._row = new XVIZTreeTableRowBuilder(id, values);\n    this._type = PRIMITIVE_TYPES.treetable;\n\n    return this._row;\n  }\n\n  _validate() {\n    super._validate();\n  }\n\n  _flush() {\n    this._validate();\n\n    this._flushPrimitives();\n  }\n\n  getData() {\n    if (this._type) {\n      this._flush();\n    }\n\n    if (Object.keys(this._primitives).length) {\n      return this._primitives;\n    }\n\n    return null;\n  }\n\n  _flushPrimitives() {\n    let stream = this._primitives[this._streamId];\n    if (!stream) {\n      stream = {};\n      this._primitives[this._streamId] = stream;\n    }\n\n    let fieldName;\n    let primitiveArray;\n\n    switch (this._type) {\n      case PRIMITIVE_TYPES.treetable:\n        fieldName = this._type;\n        if (!stream[fieldName]) {\n          // column must be set before adding rows\n          this._validator.hasProp(this, '_columns');\n\n          stream[fieldName] = {\n            columns: this._columns,\n            nodes: []\n          };\n        }\n        primitiveArray = stream[fieldName].nodes;\n        break;\n\n      default:\n    }\n\n    const primitives = this._formatPrimitives();\n    if (primitives) {\n      for (const primitive of primitives) {\n        primitiveArray.push(primitive);\n      }\n    }\n\n    this.reset();\n  }\n\n  _formatPrimitives() {\n    switch (this._type) {\n      case PRIMITIVE_TYPES.treetable:\n        if (this._row !== null) {\n          return this._row.getData();\n        }\n        break;\n\n      default:\n    }\n\n    return null;\n  }\n\n  reset() {\n    this._type = null;\n\n    this._columns = null;\n    this._row = null;\n  }\n}\n"],"file":"xviz-ui-primitive-builder.js"}