"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = createWorker;

var _getTransferList = _interopRequireDefault(require("./get-transfer-list"));

/* global TextDecoder, self */
// Set up a WebWorkerGlobalScope to talk with the main thread
function createWorker(loader) {
  if (typeof self === 'undefined') {
    return;
  }

  self.onmessage = function (evt) {
    var _evt$data = evt.data,
        arraybuffer = _evt$data.arraybuffer,
        opts = _evt$data.opts;

    try {
      var data;
      var parser;

      if (loader.parseSync) {
        data = arraybuffer;
        parser = loader.parseSync;
      } else if (loader.parseTextSync) {
        var textDecoder = new TextDecoder();
        data = textDecoder.decode(arraybuffer);
        parser = loader.parseTextSync;
      } else {
        throw new Error("Could not load data with ".concat(loader.name, " loader"));
      }

      var result = parser(data, opts);
      var transferList = (0, _getTransferList.default)(result);
      self.postMessage({
        type: 'done',
        result: result
      }, transferList);
    } catch (error) {
      self.postMessage({
        type: 'error',
        message: error.message
      });
    }
  };
}
//# sourceMappingURL=create-worker.js.map