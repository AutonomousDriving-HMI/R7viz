{"version":3,"sources":["../../../src/styles/xviz-style-property.js"],"names":["Color","log","getColor","value","color","rgb","array","Number","isFinite","error","Array","isArray","getNumber","isNaN","getBool","toLowerCase","Boolean","IDENTITY","x","PROPERTY_FORMATTERS","opacity","stroked","filled","extruded","height","stroke_color","fill_color","font_family","String","font_weight","text_size","text_rotation","text_anchor","text_baseline","radius","radius_min_pixels","radius_max_pixels","stroke_width","stroke_width_min_pixels","stroke_width_max_pixels","DEFAULT_STYLES","radius_pixels","MAX_SAFE_INTEGER","point_color_mode","point_color_domain","stylesheet","colorMode","getProperty","XVIZStyleProperty","getDefault","key","formatValue","formatter","constructor","_value","length","map","_valueCount","warn","getValue","context","index"],"mappings":"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","sourcesContent":["// Copyright (c) 2019 Uber Technologies, Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/* eslint-disable camelcase */\nimport Color from 'color';\nimport log from '../utils/log';\n\n/* Utils for type check */\nfunction getColor(value) {\n  if (typeof value === 'string') {\n    try {\n      const color = Color.rgb(value).array();\n      if (Number.isFinite(color[3])) {\n        color[3] *= 255;\n      }\n      return color;\n    } catch (error) {\n      return null;\n    }\n  }\n  if (Array.isArray(value) && Number.isFinite(value[0])) {\n    return value;\n  }\n  return null;\n}\n\nfunction getNumber(value) {\n  switch (typeof value) {\n    case 'string':\n      value = Number(value);\n      return isNaN(value) ? null : value;\n\n    case 'number':\n      return value;\n\n    default:\n      return null;\n  }\n}\n\nfunction getBool(value) {\n  switch (typeof value) {\n    case 'boolean':\n      return value;\n\n    case 'string':\n      return value.toLowerCase() !== 'false';\n\n    case 'number':\n      return Boolean(value);\n\n    default:\n      return null;\n  }\n}\n\nconst IDENTITY = x => x;\nconst PROPERTY_FORMATTERS = {\n  opacity: getNumber,\n\n  stroked: getBool,\n  filled: getBool,\n  extruded: getBool,\n  height: getNumber,\n\n  stroke_color: getColor,\n  fill_color: getColor,\n\n  font_family: String,\n  font_weight: String,\n  text_size: getNumber,\n  text_rotation: getNumber,\n  text_anchor: String,\n  text_baseline: String,\n\n  radius: getNumber,\n  radius_min_pixels: getNumber,\n  radius_max_pixels: getNumber,\n\n  stroke_width: getNumber,\n  stroke_width_min_pixels: getNumber,\n  stroke_width_max_pixels: getNumber\n};\n\nconst DEFAULT_STYLES = {\n  opacity: 1,\n\n  stroked: true,\n  filled: true,\n  extruded: false,\n  height: 0,\n\n  stroke_color: [0, 0, 0],\n  fill_color: [255, 255, 255],\n\n  font_family: 'Arial',\n  font_weight: 'normal',\n  text_size: 12,\n  text_rotation: 0,\n  text_anchor: 'middle',\n  text_baseline: 'center',\n\n  radius: 1,\n  radius_pixels: 1,\n  radius_min_pixels: 0,\n  radius_max_pixels: Number.MAX_SAFE_INTEGER,\n\n  stroke_width: 0.1,\n  stroke_width_min_pixels: 0,\n  stroke_width_max_pixels: Number.MAX_SAFE_INTEGER,\n\n  point_color_mode: 'default',\n  point_color_domain: stylesheet => {\n    const colorMode = stylesheet.getProperty('point_color_mode');\n    switch (colorMode) {\n      case 'elevation':\n        return [0, 3];\n      case 'distance_to_vehicle':\n        return [0, 60];\n      default:\n        return [0, 0];\n    }\n  }\n};\n\nexport default class XVIZStyleProperty {\n  static getDefault(key) {\n    return DEFAULT_STYLES[key];\n  }\n\n  static formatValue(key, value) {\n    const formatter = PROPERTY_FORMATTERS[key] || IDENTITY;\n    return formatter(value);\n  }\n\n  constructor(key, value) {\n    this.key = key;\n\n    const formatter = PROPERTY_FORMATTERS[key] || IDENTITY;\n    this._value = formatter(value);\n\n    if (this._value === null && Array.isArray(value)) {\n      if (value.length > 1) {\n        this._value = value.map(formatter);\n        this._valueCount = value.length;\n      } else {\n        this._value = formatter(value[0]);\n      }\n    }\n    if (this._value === null) {\n      log.warn(`illegal ${key} value: ${value}`)();\n    }\n  }\n\n  getValue(context) {\n    if (this._valueCount) {\n      const index = (context.index || 0) % this._valueCount;\n      return this._value[index];\n    }\n    return this._value;\n  }\n}\n"],"file":"xviz-style-property.js"}