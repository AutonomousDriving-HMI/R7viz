{"version":3,"sources":["../../../src/parsers/xviz-primitives-v1.js"],"names":["filterVertices","PRIMITIVE_CAT","text","category","LABEL","validate","primitive","tree_table","COMPONENT","points3d","POINTCLOUD","streamName","time","vertices","length","points2d","FEATURE","normalize","i","point2d","enableZOffSet","line2d","enableZOffset","polygon2d","Array","isArray","push","circle","circle2d","center"],"mappings":"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","sourcesContent":["// Copyright (c) 2019 Uber Technologies, Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport {filterVertices} from './filter-vertices';\nimport {PRIMITIVE_CAT} from './parse-xviz-primitive';\n\n// TODO - tests for all primitive types\nexport default {\n  text: {\n    category: PRIMITIVE_CAT.LABEL,\n    validate: primitive => true\n  },\n  // eslint-disable-next-line camelcase\n  tree_table: {\n    category: PRIMITIVE_CAT.COMPONENT,\n    validate: primitive => true\n  },\n  points3d: {\n    category: PRIMITIVE_CAT.POINTCLOUD,\n    validate: (primitive, streamName, time) => primitive.vertices && primitive.vertices.length > 0\n  },\n  points2d: {\n    category: PRIMITIVE_CAT.FEATURE,\n    validate: (primitive, streamName, time) => primitive.vertices && primitive.vertices.length > 0,\n    normalize: primitive => {\n      for (let i = 0; i < primitive.vertices.length; i++) {\n        primitive.vertices[i][2] = 0;\n      }\n    }\n  },\n  point2d: {\n    category: PRIMITIVE_CAT.FEATURE,\n    enableZOffSet: true,\n    validate: (primitive, streamName, time) =>\n      primitive.vertices && primitive.vertices.length === 1,\n    normalize: primitive => {\n      primitive.vertices = primitive.vertices[0];\n    }\n  },\n  line2d: {\n    category: PRIMITIVE_CAT.FEATURE,\n    enableZOffset: true,\n    validate: (primitive, streamName, time) =>\n      primitive.vertices &&\n      primitive.vertices.length >= 2 &&\n      streamName !== '/route_follower/kickout/object/velocity',\n    normalize: primitive => {\n      // Filter out identical vertices to make sure we don't get rendering artifacts\n      // in the path layer\n      // TODO - handle this directly in deck.gl PathLayer\n      primitive.vertices = filterVertices(primitive.vertices);\n    }\n  },\n  polygon2d: {\n    category: PRIMITIVE_CAT.FEATURE,\n    enableZOffset: true,\n    validate: (primitive, streamName, time) => primitive.vertices && primitive.vertices.length >= 3,\n    normalize: primitive => {\n      // This is a polygon2d primitive which per XVIZ protocol implicitly says\n      // that the provided path is closed. Push a copy of first vert to end of array.\n      // Array comparison turns out to be expensive. Looks like the polygon returned\n      // from XVIS is never closed - worst case we end up with a duplicate end vertex,\n      // which will not break the polygon layer.\n      // TODO - can't handle flat arrays for now\n      if (Array.isArray(primitive.vertices)) {\n        primitive.vertices.push(primitive.vertices[0]);\n      }\n    }\n  },\n  circle: {\n    category: PRIMITIVE_CAT.FEATURE,\n    enableZOffset: true,\n    validate: (primitive, streamName, time) => primitive.vertices && primitive.vertices.length > 0\n  },\n  circle2d: {\n    category: PRIMITIVE_CAT.FEATURE,\n    enableZOffset: true,\n    validate: (primitive, streamName, time) => primitive.center,\n    normalize: primitive => {\n      primitive.vertices = primitive.center;\n    }\n  }\n};\n"],"file":"xviz-primitives-v1.js"}