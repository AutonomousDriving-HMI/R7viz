{"version":3,"sources":["../../../src/parsers/xviz-primitives-v2.js"],"names":["filterVertices","PRIMITIVE_CAT","base64js","aliasId","primitive","base","object_id","id","text","category","FEATURE","validate","normalize","circle","center","stadium","start","end","polyline","streamName","time","vertices","length","polygon","point","POINTCLOUD","points","image","IMAGE","data","imageData","toByteArray","imgType","format","imageType","position"],"mappings":"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","sourcesContent":["// Copyright (c) 2019 Uber Technologies, Inc.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//     http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\nimport {filterVertices} from './filter-vertices';\nimport {PRIMITIVE_CAT} from './parse-xviz-primitive';\nimport base64js from 'base64-js';\n\nfunction aliasId(primitive) {\n  if (primitive && primitive.base && primitive.base.object_id) {\n    primitive.id = primitive.base.object_id;\n  }\n}\n\n// TODO - tests for all primitive types\nexport default {\n  text: {\n    category: PRIMITIVE_CAT.FEATURE,\n    validate: primitive => true,\n    normalize: primitive => {\n      aliasId(primitive);\n    }\n  },\n  circle: {\n    category: PRIMITIVE_CAT.FEATURE,\n    validate: primitive => primitive.center,\n    normalize: primitive => {\n      aliasId(primitive);\n    }\n  },\n  stadium: {\n    category: PRIMITIVE_CAT.FEATURE,\n    validate: primitive => primitive.start && primitive.end,\n    normalize: primitive => {\n      aliasId(primitive);\n    }\n  },\n  polyline: {\n    category: PRIMITIVE_CAT.FEATURE,\n    validate: (primitive, streamName, time) => primitive.vertices && primitive.vertices.length >= 2,\n    normalize: primitive => {\n      // Filter out identical vertices to make sure we don't get rendering artifacts\n      // in the path layer\n      // TODO - handle this directly in deck.gl PathLayer\n      primitive.vertices = filterVertices(primitive.vertices);\n      aliasId(primitive);\n    }\n  },\n  polygon: {\n    category: PRIMITIVE_CAT.FEATURE,\n    validate: (primitive, streamName, time) => primitive.vertices && primitive.vertices.length >= 3,\n    normalize: primitive => {\n      aliasId(primitive);\n    }\n  },\n  point: {\n    category: PRIMITIVE_CAT.POINTCLOUD,\n    validate: (primitive, streamName, time) => primitive.points && primitive.points.length > 0,\n    normalize: primitive => {\n      // Alias XVIZ 2.0 to normalized vertices field.\n      primitive.vertices = primitive.points;\n      aliasId(primitive);\n    }\n  },\n  image: {\n    category: PRIMITIVE_CAT.IMAGE,\n    validate: (primitive, streamName, time) => primitive.data,\n    normalize: primitive => {\n      let imageData = primitive.data;\n      delete primitive.data;\n      if (typeof imageData === 'string') {\n        imageData = base64js.toByteArray(imageData);\n      }\n      // format is not part of v2 spec\n      const imgType = primitive.format ? `image/${primitive.format}` : null;\n      primitive.imageData = imageData;\n      primitive.imageType = imgType;\n      if (primitive.position) {\n        primitive.vertices = primitive.position;\n      }\n      aliasId(primitive);\n    }\n  }\n};\n"],"file":"xviz-primitives-v2.js"}